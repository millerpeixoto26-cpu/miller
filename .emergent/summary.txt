<analysis>
The previous AI engineer successfully developed a full-stack application for selling rituals and spiritual services, adopting a user-centric, iterative development approach. Initial work established core functionalities like ritual selection, Stripe payment, and an admin panel for orders. Key milestones included resolving MongoDB serialization issues and enhancing UI responsiveness. Subsequent phases introduced advanced features: comprehensive ritual management (visibility, discounts), JWT-based admin authentication, dynamic site customization (logo, colors, WhatsApp), configurable Rituais da Semana, and flexible payment gateway configurations (Stripe, PagBank, Mercado Pago). The project then progressed through Instagram integration, a detailed sales dashboard, a full appointment scheduling system (both admin and public), and WhatsApp Business API integration for notifications and reports. Most recently, several major improvements were implemented, including automatic database backups, intelligent caching, automated reminders/reports, follow-up features, remarketing, custom coupons, loyalty programs, and friend referrals, alongside a simplified public booking form. The latest challenge involves a frontend display issue with the newly added coupons and referral features, where the backend is confirmed functional but the UI doesn't render them.
</analysis>

<product_requirements>
The core requirement was a simple system for selling rituals with online payment (Stripe), client data collection post-payment, and an admin panel to view orders and client data (with a WhatsApp button). The system needed to be discreet and easy to manage, with optional appointment scheduling and WhatsApp reminders.

Subsequently, the user requested significant enhancements:
- Editable rituals with visibility, description, price, and discount options.
- Homepage display of professional Instagram profile and latest posts.
- Admin panel for configuring payment gateways (Stripe, PagBank, Mercado Pago).
- Admin authentication and user management (add/deregister admins).
- Comprehensive appointment scheduling: client selects and pays, automated WhatsApp messages (confirmation, reminders, cancellations, delays), and daily WhatsApp reports to the mentor.
- All notifications via WhatsApp API.
- Sales dashboard in admin panel: finalized sales, ritual vs. consultation breakdown, daily/monthly sales quantity and value, and monthly revenue target.
- Automatic database backup (with admin tab for manual backup).
- Intelligent caching for faster loading.
- Automated reminders (24h/1h before consultation) and daily reports (12h/18h/22h).
- Post-consultation follow-up, remarketing campaigns via WhatsApp, custom discount coupons, loyalty program, and friend referral system.
- Simplified public appointment booking: only name, WhatsApp, and time needed.
</product_requirements>

<key_technical_concepts>
-   **Full-stack:** FastAPI (Python) backend, React (JavaScript) frontend.
-   **Database:** MongoDB.
-   **UI:** Shadcn UI components, Tailwind CSS.
-   **Authentication:** JWT (JSON Web Tokens), bcrypt.
-   **Payment Gateways:** Stripe (via ), PagBank, Mercado Pago.
-   **Data Validation:** Pydantic (backend).
-   **Routing:** React Router DOM.
-   **API Client:** Axios.
-   **Scheduling:** APScheduler (for cron jobs).
</key_technical_concepts>

<code_architecture>
The application uses a standard full-stack architecture: React frontend, FastAPI backend, and MongoDB database.



-   
    -   **Importance:** Contains FastAPI app setup, MongoDB connection, Pydantic models, and all API endpoints.
    -   **Changes Made:** Extended with models for , , , , , , , , , , , , , , , , , , , . Implemented full CRUD APIs for all, JWT authentication, and MongoDB  serialization fix. Added  for cron jobs (reminders, reports, backups).

-   
    -   **Importance:** Main React component, handles routing, global context, and dynamic content display.
    -   **Changes Made:** Integrated . Configured  for public and protected routes. Incorporated dynamic styling. Added  tabs (Orders, Rituals, Rituals of the Week, Config, Users, Payments, Instagram, Agendamentos, WhatsApp, Promoções, Backups) and their respective content. Modified for dynamic Instagram profile/posts display, sales dashboard, and public appointment booking section. Fixed  icon import.

-    (Note: admin logic was largely migrated to App.js or new tab components)
    -   **Importance:** Initial central component for admin dashboard.
    -   **Changes Made:** Converted to tabbed interface using Shadcn UI. Functionality migrated to  or dedicated tab components.

-   
    -   **Importance:** Manages global authentication state.
    -   **Changes Made:** New file for JWT token, user info, login/logout logic.

-   
    -   **Importance:** UI for admin login.
    -   **Changes Made:** New file for username/password input and calling login from .

-   
    -   **Importance:** Global CSS.
    -   **Changes Made:** Added responsive classes, custom CSS variables for dynamic colors.

-   
    -   **Importance:** Shadcn UI Button.
    -   **Changes Made:** Modified for dynamic primary/secondary color gradients.

-   
    -   **Importance:** Shadcn UI Select.
    -   **Changes Made:** Adjusted to handle empty initial values.

-   
    -   **Importance:** Manages appointment types and available schedules within the admin panel.
    -   **Changes Made:** New file created.

-   
    -   **Importance:** Provides the public interface for booking appointments on the homepage.
    -   **Changes Made:** New file created; simplified form to name, WhatsApp, and time.

-   
    -   **Importance:** Manages coupons, loyalty, and referral programs in the admin panel.
    -   **Changes Made:** New file created.

-   
    -   **Importance:** Manages manual database backups in the admin panel.
    -   **Changes Made:** New file created.

-   
    -   **Importance:** Manages WhatsApp configuration and message templates in the admin panel.
    -   **Changes Made:** New file created.
</code_architecture>

<pending_tasks>
-   **Frontend adjustment for Coupons and Referrals**: The backend endpoints for these features are confirmed working, but the UI for Sistema de cupons (Coupon system) and indicações (referrals) is not appearing correctly in the admin panel. The frontend needs to be adjusted to load and display these features.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was addressing a user report that the Sistema de cupons pronto para uso nao aparece nem de indicacoes (Coupon system ready for use, neither referrals appear) in the admin panel, despite the AI previously stating it was implemented.

The AI engineer has confirmed that the backend () for both coupon and referral functionalities is 100% operational and responding correctly. This was verified through backend testing.

The current focus is on debugging and fixing the frontend. The AI engineer has identified that O problema está no frontend - vou verificar se os dados estão sendo carregados corretamente e ajustar a interface. This implies inspecting the  component, the  where the tab is integrated, and the API calls to ensure the data for coupons and referrals is fetched and rendered as expected. The task is to visually display the coupon system and referral information within the admin panel's Promoções tab.
</current_work>

<optional_next_step>
Adjust the frontend interface in  and  to correctly load and display the coupon and referral systems.
</optional_next_step>
